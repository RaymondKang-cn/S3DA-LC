import os
import torch
import time
import numpy as np
import argparse
from config_populate import data_settings


def gen_exp_name(expt):
    st = expt
    st = '_'.join([st, str(settings['bb'])])
    st = '_'.join([st, dataset])
    st = '_'.join([st, task])
    return st


settings = {}
parser = argparse.ArgumentParser(description='CS-DW')
parser.add_argument('--dataset', type=str, default='domain-net',
                    choices=['office-31', 'office-home', 'office-caltech', 'image-clef', 'domain-net'])
parser.add_argument('--task', type=str, default='APR_C')
parser.add_argument('--net', type=str, default='resnet50', choices=['resnet50', 'resnet101'])

parser.add_argument('--tau', type=float, default=0.9)
parser.add_argument('--use_source', type=int, default=1, choices=[0, 1])
parser.add_argument('--fix', type=int, default=0, choices=[0, 1])
parser.add_argument('--alpha', type=float, default=-1)
parser.add_argument('--use_weight', type=int, default=1, choices=[0, 1])

parser.add_argument('--expt', type=str, default='expt', choices=['expt', 'paramsen'])
parser.add_argument('--path', type=str, default='/data/DA',
                    choices=['/data/DA', '/root/autodl-tmp/', 'E:/Projects/DATA'])
parser.add_argument('--load', type=int, default=1, choices=[0, 1])
parser.add_argument('--load_iter', type=int, default=-1)
parser.add_argument('--worker', type=int, default=10)
parser.add_argument('--gpu', type=int, default=0)
args = parser.parse_args()

server_root_path = args.path
dataset = args.dataset
task = args.task
begin_time = time.time()
eval_time = time.time()
settings['dataset_name'] = dataset
settings['data_key'] = task
settings['server_root_path'] = server_root_path
settings['dataset_dir'] = os.path.join(dataset)
settings['expt'] = args.expt
# dataset settings

settings['C'] = data_settings[dataset][task]['C']
settings['C_dash'] = data_settings[dataset][task]['C_dash']
settings['num_C_dash'] = data_settings[dataset][task]['num_C_dash']

settings['num_C'] = data_settings[dataset][task]['num_C']
settings['src_datasets'] = data_settings[dataset][task]['src_datasets']
settings['trgt_datasets'] = data_settings[dataset][task]['trgt_datasets']

settings['class_num'] = settings['num_C'][settings['trgt_datasets'][0]]

st0 = np.random.get_state()[1][0]
t0 = torch.initial_seed()
settings['seed_value'] = {'torch': t0, 'np': st0}

settings['resolution'] = 224

settings['index_list'] = 'index_list'

if settings['dataset_name'] == 'domain-net':
    settings['bb'] = 'resnet101'
else:
    settings['bb'] = args.net
settings['bb_output'] = 2048
settings['F_dims'] = 256

settings['softmax_temperature'] = 1

# optimizer settings
settings['net_list'] = ['B', 'F', 'C']

settings['lr'] = 1e-5
settings['target_label_logit_key'] = 8

settings['exp_name'] = gen_exp_name(args.expt)

settings['mode'] = {'train': 0, 'val': 1}

settings['gpu'] = args.gpu
settings['device'] = 'cuda:' + str(settings['gpu'])
torch.cuda.set_device(settings['gpu'])
settings['tb_port_no'] = 9999 - settings['gpu']

settings['checkpoints_count'] = 1

settings['expt_dict'] = {
    'office-31': {
        'AD_W': {'enough_iter': 2000, 'max_iter': 8000, 'val_after': 100, 'batch_size': 16,
                 'val_batch_size_factor': 20},
        'DW_A': {'enough_iter': 2000, 'max_iter': 8000, 'val_after': 100, 'batch_size': 32,
                 'val_batch_size_factor': 20},
        'AW_D': {'enough_iter': 2000, 'max_iter': 8000, 'val_after': 100, 'batch_size': 16,
                 'val_batch_size_factor': 20}
    },
    'domain-net': {
        'CIPQR_S': {'enough_iter': 60000, 'max_iter': 250000, 'val_after': 6000, 'batch_size': 16,
                    'val_batch_size_factor': 25},
        'CIPQS_R': {'enough_iter': 60000, 'max_iter': 250000, 'val_after': 6000, 'batch_size': 16,
                    'val_batch_size_factor': 25},
        'CIPSR_Q': {'enough_iter': 60000, 'max_iter': 250000, 'val_after': 6000, 'batch_size': 16,
                    'val_batch_size_factor': 25},  # 60000, 250000, 6000, 16, 25
        'CPQRS_I': {'enough_iter': 60000, 'max_iter': 250000, 'val_after': 6000, 'batch_size': 16,
                    'val_batch_size_factor': 25},
        'CIQRS_P': {'enough_iter': 60000, 'max_iter': 250000, 'val_after': 6000, 'batch_size': 16,
                    'val_batch_size_factor': 25},
        'IPQRS_C': {'enough_iter': 90000, 'max_iter': 250000, 'val_after': 6000, 'batch_size': 16,
                    'val_batch_size_factor': 25}
    },
    'image-clef': {
        'PC_I': {'enough_iter': 1200, 'max_iter': 3000, 'val_after': 100, 'batch_size': 16,
                 'val_batch_size_factor': 20},
        'IC_P': {'enough_iter': 1500, 'max_iter': 3000, 'val_after': 100, 'batch_size': 16,
                 'val_batch_size_factor': 20},
        'IP_C': {'enough_iter': 1200, 'max_iter': 3000, 'val_after': 100, 'batch_size': 16,
                 'val_batch_size_factor': 20}
    },
    'office-home': {
        'ACP_R': {'enough_iter': 4000, 'max_iter': 20000, 'val_after': 500, 'batch_size': 24,
                  'val_batch_size_factor': 10},
        'ACR_P': {'enough_iter': 4000, 'max_iter': 20000, 'val_after': 500, 'batch_size': 24,
                  'val_batch_size_factor': 10},
        'APR_C': {'enough_iter': 4000, 'max_iter': 20000, 'val_after': 500, 'batch_size': 24,
                  'val_batch_size_factor': 10},
        'CPR_A': {'enough_iter': 4000, 'max_iter': 20000, 'val_after': 500, 'batch_size': 24,
                  'val_batch_size_factor': 10}
    },
    'office-caltech': {
        'ACD_W': {'enough_iter': 500, 'max_iter': 1500, 'val_after': 100, 'batch_size': 13,
                  'val_batch_size_factor': 10},
        'ADW_C': {'enough_iter': 500, 'max_iter': 1500, 'val_after': 100, 'batch_size': 13,
                  'val_batch_size_factor': 10},
        'ACW_D': {'enough_iter': 500, 'max_iter': 1500, 'val_after': 100, 'batch_size': 13,
                  'val_batch_size_factor': 10},
        'CDW_A': {'enough_iter': 500, 'max_iter': 1500, 'val_after': 100, 'batch_size': 13,
                  'val_batch_size_factor': 10}
    }
}

settings['sample_num'] = {
    'office-31': {
        'amazon': [92, 82, 72, 82, 36, 94, 91, 97, 97, 81, 99, 100, 100, 98, 100, 99, 100, 94, 96, 95, 93, 100, 98, 98,
                   90,
                   75, 100, 99, 99, 96, 64],
        'dslr': [12, 21, 24, 12, 16, 12, 13, 14, 15, 15, 13, 10, 24, 16, 31, 22, 12, 8, 10, 10, 13, 15, 23, 18, 10, 7,
                 18,
                 26, 21, 22, 15],
        'webcam': [29, 21, 28, 12, 16, 31, 40, 18, 21, 19, 27, 27, 30, 19, 30, 43, 30, 27, 28, 32, 16, 20, 30, 27, 40,
                   11,
                   25, 30, 24, 23, 21]
    },
    'office-home': {
        'Art': [74, 41, 27, 40, 75, 99, 40, 33, 20, 76, 69, 25, 44, 40, 40, 23, 15, 18, 21, 45, 22, 46, 90, 20, 46, 40,
                40, 79, 46, 18, 72, 49, 51, 20, 42, 32, 18, 49, 21, 20, 19, 19, 20, 26, 19, 18, 24, 47, 49, 15, 20, 30,
                42, 41, 46, 40, 20, 46, 40, 16, 44, 43, 20, 21, 16],
        'Clipart': [60, 56, 64, 98, 99, 99, 73, 46, 78, 99, 99, 40, 99, 64, 42, 41, 48, 40, 41, 50, 40, 40, 99, 99, 61,
                    52,
                    99, 69, 40, 99, 53, 40, 99, 71, 99, 40, 76, 99, 83, 40, 51, 40, 99, 99, 41, 87, 40, 46, 40, 67, 99,
                    75,
                    42, 42, 43, 61, 90, 60, 99, 80, 99, 39, 99, 53, 40],
        'Product': [79, 99, 62, 43, 44, 62, 47, 81, 81, 56, 99, 65, 96, 88, 75, 83, 67, 41, 67, 58, 71, 99, 91, 90, 41,
                    67,
                    57, 90, 72, 99, 41, 54, 99, 56, 98, 72, 96, 41, 93, 68, 70, 47, 60, 40, 38, 99, 43, 43, 59, 58, 99,
                    40,
                    49, 46, 99, 43, 99, 47, 76, 60, 58, 42, 45, 93, 98],
        'Real_World': [86, 99, 64, 83, 99, 78, 80, 73, 68, 99, 96, 65, 64, 76, 73, 62, 51, 43, 81, 60, 58, 85, 75, 57,
                       36, 60,
                       52, 60, 72, 75, 83, 78, 67, 23, 71, 46, 60, 58, 68, 64, 30, 68, 65, 59, 67, 52, 53, 66, 75, 41,
                       77, 51,
                       66, 77, 88, 63, 81, 54, 53, 59, 82, 85, 67, 81, 49]
    },
    'domain-net': {
        "clipart": [
            79,
            80,
            105,
            18,
            51,
            65,
            56,
            115,
            163,
            56,
            85,
            61,
            35,
            34,
            33,
            23,
            35,
            32,
            109,
            81,
            71,
            54,
            42,
            24,
            70,
            73,
            86,
            109,
            137,
            141,
            95,
            49,
            49,
            171,
            234,
            115,
            74,
            119,
            116,
            64,
            82,
            93,
            203,
            53,
            135,
            46,
            73,
            118,
            99,
            77,
            70,
            32,
            112,
            83,
            59,
            38,
            46,
            107,
            40,
            126,
            85,
            99,
            72,
            47,
            69,
            36,
            32,
            30,
            24,
            26,
            65,
            65,
            156,
            37,
            137,
            149,
            47,
            120,
            249,
            131,
            200,
            67,
            149,
            11,
            131,
            75,
            98,
            114,
            144,
            144,
            74,
            144,
            76,
            127,
            49,
            58,
            97,
            56,
            73,
            28,
            94,
            135,
            99,
            269,
            70,
            139,
            80,
            102,
            95,
            75,
            138,
            37,
            97,
            187,
            114,
            107,
            104,
            96,
            116,
            91,
            191,
            154,
            102,
            125,
            177,
            163,
            58,
            139,
            114,
            130,
            40,
            102,
            92,
            156,
            142,
            65,
            100,
            69,
            121,
            102,
            63,
            178,
            84,
            197,
            96,
            99,
            114,
            135,
            131,
            107,
            139,
            66,
            137,
            26,
            100,
            70,
            74,
            17,
            63,
            112,
            50,
            72,
            73,
            40,
            21,
            31,
            22,
            51,
            125,
            17,
            8,
            61,
            8,
            46,
            86,
            115,
            9,
            32,
            70,
            170,
            51,
            12,
            29,
            39,
            42,
            51,
            144,
            98,
            11,
            85,
            88,
            39,
            29,
            46,
            51,
            149,
            77,
            109,
            94,
            27,
            54,
            39,
            36,
            18,
            133,
            60,
            9,
            91,
            41,
            17,
            45,
            60,
            11,
            81,
            57,
            50,
            18,
            57,
            51,
            62,
            35,
            84,
            14,
            32,
            60,
            65,
            104,
            58,
            53,
            26,
            71,
            72,
            96,
            200,
            63,
            60,
            17,
            27,
            72,
            129,
            21,
            43,
            41,
            83,
            80,
            71,
            58,
            92,
            100,
            140,
            113,
            128,
            53,
            164,
            139,
            142,
            119,
            143,
            164,
            209,
            142,
            78,
            88,
            96,
            148,
            93,
            182,
            124,
            136,
            67,
            78,
            115,
            117,
            194,
            122,
            121,
            59,
            116,
            186,
            112,
            159,
            130,
            112,
            103,
            154,
            270,
            75,
            108,
            201,
            240,
            143,
            117,
            178,
            248,
            228,
            97,
            240,
            261,
            170,
            327,
            155,
            98,
            96,
            88,
            67,
            206,
            155,
            76,
            102,
            94,
            129,
            107,
            220,
            137,
            58,
            119,
            68,
            110,
            68,
            113,
            106,
            145,
            76,
            87,
            122,
            156,
            74,
            81,
            98,
            175,
            140,
            111,
            118,
            185,
            133,
            111,
            239,
            92,
            171,
            159,
            152,
            199,
            114,
            163,
            221
        ],
        "infograph": [
            132,
            56,
            78,
            61,
            43,
            16,
            14,
            11,
            47,
            43,
            16,
            52,
            90,
            93,
            62,
            238,
            263,
            224,
            103,
            258,
            232,
            153,
            150,
            67,
            94,
            128,
            55,
            65,
            125,
            163,
            66,
            31,
            190,
            38,
            142,
            48,
            149,
            77,
            131,
            31,
            18,
            66,
            86,
            198,
            160,
            42,
            156,
            24,
            39,
            38,
            128,
            8,
            113,
            25,
            90,
            19,
            37,
            21,
            46,
            18,
            37,
            45,
            9,
            48,
            249,
            169,
            86,
            120,
            44,
            117,
            23,
            101,
            20,
            14,
            173,
            17,
            34,
            99,
            133,
            25,
            67,
            54,
            14,
            40,
            92,
            35,
            28,
            38,
            11,
            65,
            28,
            76,
            32,
            8,
            153,
            109,
            44,
            34,
            21,
            16,
            30,
            12,
            35,
            58,
            40,
            47,
            130,
            42,
            23,
            117,
            81,
            75,
            23,
            298,
            69,
            49,
            41,
            68,
            27,
            134,
            27,
            41,
            37,
            69,
            98,
            28,
            76,
            43,
            81,
            45,
            198,
            31,
            116,
            148,
            118,
            116,
            205,
            139,
            145,
            46,
            180,
            25,
            138,
            155,
            33,
            149,
            172,
            253,
            41,
            125,
            146,
            33,
            33,
            90,
            57,
            70,
            214,
            202,
            47,
            127,
            54,
            18,
            42,
            47,
            65,
            39,
            75,
            67,
            39,
            81,
            67,
            115,
            127,
            16,
            46,
            47,
            145,
            44,
            72,
            30,
            19,
            31,
            144,
            30,
            12,
            63,
            21,
            49,
            76,
            59,
            136,
            162,
            146,
            39,
            33,
            17,
            72,
            25,
            193,
            171,
            77,
            150,
            32,
            80,
            33,
            42,
            32,
            73,
            29,
            18,
            187,
            60,
            115,
            17,
            42,
            42,
            84,
            42,
            77,
            76,
            255,
            137,
            43,
            81,
            42,
            141,
            114,
            92,
            107,
            45,
            35,
            48,
            119,
            54,
            25,
            39,
            50,
            81,
            92,
            16,
            69,
            52,
            30,
            43,
            49,
            61,
            104,
            104,
            32,
            34,
            82,
            65,
            23,
            48,
            67,
            68,
            33,
            20,
            127,
            19,
            192,
            48,
            201,
            19,
            11,
            22,
            34,
            20,
            109,
            9,
            32,
            11,
            37,
            56,
            28,
            85,
            114,
            316,
            52,
            106,
            88,
            276,
            146,
            79,
            124,
            196,
            142,
            247,
            231,
            74,
            199,
            37,
            174,
            214,
            79,
            58,
            126,
            155,
            245,
            36,
            64,
            24,
            86,
            168,
            217,
            505,
            146,
            284,
            193,
            379,
            135,
            162,
            189,
            219,
            229,
            354,
            323,
            346,
            250,
            227,
            213,
            191,
            257,
            350,
            253,
            129,
            450,
            155,
            346,
            234,
            541,
            212,
            177,
            353,
            256,
            220,
            267,
            264,
            242,
            303,
            385,
            327,
            304,
            207,
            280
        ],
        "painting": [
            220,
            108,
            130,
            93,
            144,
            58,
            51,
            352,
            416,
            164,
            105,
            311,
            295,
            283,
            153,
            185,
            250,
            135,
            298,
            84,
            94,
            288,
            192,
            213,
            30,
            349,
            265,
            259,
            32,
            219,
            11,
            116,
            136,
            103,
            155,
            83,
            9,
            114,
            44,
            28,
            373,
            197,
            105,
            163,
            219,
            329,
            70,
            58,
            42,
            40,
            78,
            46,
            270,
            85,
            107,
            8,
            30,
            202,
            109,
            50,
            151,
            180,
            37,
            266,
            31,
            185,
            157,
            240,
            26,
            92,
            110,
            36,
            39,
            99,
            204,
            62,
            182,
            194,
            129,
            54,
            11,
            37,
            9,
            18,
            109,
            107,
            12,
            84,
            55,
            153,
            363,
            11,
            74,
            85,
            503,
            280,
            261,
            242,
            161,
            98,
            14,
            142,
            293,
            132,
            130,
            59,
            296,
            203,
            11,
            201,
            58,
            14,
            11,
            240,
            34,
            39,
            20,
            10,
            238,
            268,
            154,
            292,
            144,
            7,
            339,
            169,
            59,
            58,
            116,
            118,
            148,
            125,
            73,
            73,
            443,
            218,
            229,
            142,
            100,
            31,
            177,
            156,
            275,
            126,
            173,
            179,
            18,
            112,
            155,
            130,
            364,
            35,
            317,
            102,
            136,
            141,
            73,
            287,
            93,
            217,
            190,
            37,
            146,
            66,
            259,
            89,
            21,
            291,
            152,
            107,
            350,
            124,
            336,
            18,
            284,
            137,
            351,
            352,
            137,
            176,
            174,
            70,
            296,
            72,
            39,
            108,
            69,
            102,
            7,
            279,
            225,
            45,
            74,
            223,
            306,
            291,
            35,
            261,
            176,
            586,
            241,
            356,
            327,
            13,
            229,
            329,
            7,
            346,
            114,
            251,
            410,
            184,
            265,
            78,
            91,
            234,
            23,
            57,
            311,
            61,
            126,
            308,
            201,
            99,
            258,
            227,
            95,
            233,
            88,
            203,
            60,
            416,
            62,
            118,
            60,
            40,
            70,
            34,
            187,
            174,
            45,
            245,
            58,
            40,
            76,
            153,
            168,
            387,
            52,
            209,
            225,
            89,
            105,
            247,
            43,
            44,
            91,
            45,
            281,
            113,
            188,
            233,
            182,
            111,
            77,
            65,
            104,
            130,
            124,
            11,
            53,
            223,
            295,
            74,
            186,
            430,
            142,
            20,
            69,
            136,
            75,
            22,
            70,
            308,
            377,
            12,
            48,
            25,
            5,
            198,
            9,
            55,
            9,
            261,
            307,
            42,
            280,
            99,
            246,
            236,
            76,
            71,
            206,
            5,
            0,
            70,
            269,
            192,
            53,
            34,
            12,
            97,
            295,
            72,
            1,
            21,
            76,
            6,
            21,
            257,
            128,
            39,
            282,
            387,
            207,
            122,
            80,
            85,
            201,
            5,
            8,
            180,
            139,
            10,
            286,
            4,
            248,
            13,
            277,
            41,
            113,
            11,
            112,
            207,
            77
        ],
        "sketch": [
            192,
            93,
            99,
            44,
            231,
            141,
            80,
            208,
            77,
            77,
            62,
            126,
            174,
            144,
            145,
            153,
            142,
            39,
            140,
            33,
            133,
            133,
            112,
            112,
            146,
            55,
            124,
            335,
            131,
            100,
            87,
            190,
            240,
            184,
            214,
            163,
            42,
            89,
            102,
            83,
            97,
            225,
            210,
            189,
            192,
            234,
            125,
            163,
            113,
            139,
            155,
            433,
            174,
            42,
            46,
            48,
            41,
            91,
            76,
            48,
            58,
            53,
            65,
            90,
            101,
            23,
            39,
            91,
            17,
            16,
            44,
            67,
            23,
            24,
            141,
            20,
            30,
            70,
            23,
            8,
            19,
            23,
            59,
            42,
            11,
            106,
            199,
            112,
            121,
            107,
            271,
            80,
            28,
            46,
            217,
            59,
            88,
            251,
            136,
            9,
            100,
            149,
            192,
            129,
            139,
            107,
            186,
            125,
            33,
            342,
            150,
            312,
            42,
            210,
            98,
            198,
            98,
            84,
            229,
            259,
            99,
            64,
            83,
            190,
            235,
            94,
            179,
            123,
            142,
            92,
            67,
            58,
            130,
            124,
            483,
            200,
            120,
            126,
            127,
            49,
            166,
            31,
            53,
            130,
            76,
            137,
            146,
            80,
            62,
            71,
            71,
            16,
            118,
            96,
            33,
            92,
            100,
            109,
            67,
            127,
            55,
            65,
            85,
            95,
            44,
            190,
            85,
            168,
            26,
            219,
            263,
            95,
            283,
            82,
            267,
            62,
            16,
            230,
            77,
            119,
            74,
            105,
            135,
            168,
            38,
            132,
            159,
            107,
            118,
            116,
            108,
            99,
            146,
            135,
            88,
            64,
            119,
            117,
            176,
            15,
            79,
            70,
            50,
            80,
            104,
            110,
            104,
            140,
            22,
            52,
            113,
            54,
            95,
            81,
            162,
            186,
            65,
            91,
            127,
            55,
            18,
            146,
            83,
            131,
            79,
            157,
            80,
            91,
            140,
            114,
            82,
            65,
            72,
            81,
            34,
            57,
            65,
            157,
            63,
            241,
            115,
            161,
            32,
            65,
            32,
            128,
            85,
            69,
            42,
            91,
            251,
            90,
            74,
            215,
            244,
            302,
            318,
            251,
            177,
            362,
            344,
            316,
            449,
            362,
            421,
            322,
            290,
            408,
            325,
            411,
            304,
            279,
            325,
            272,
            321,
            497,
            261,
            314,
            327,
            450,
            280,
            469,
            501,
            306,
            270,
            366,
            142,
            164,
            60,
            156,
            23,
            75,
            181,
            137,
            181,
            43,
            142,
            216,
            178,
            163,
            116,
            66,
            261,
            147,
            103,
            201,
            220,
            140,
            176,
            86,
            141,
            233,
            264,
            183,
            48,
            78,
            123,
            162,
            108,
            135,
            182,
            84,
            168,
            379,
            206,
            129,
            166,
            125,
            200,
            87,
            94,
            126,
            142,
            105,
            88,
            72,
            189,
            116,
            168,
            184,
            153,
            145,
            175,
            191,
            100
        ],
        "real": [
            360,
            368,
            155,
            273,
            152,
            364,
            436,
            21,
            310,
            266,
            232,
            37,
            164,
            458,
            267,
            307,
            180,
            274,
            218,
            60,
            79,
            309,
            165,
            251,
            361,
            435,
            409,
            509,
            506,
            310,
            461,
            461,
            493,
            278,
            558,
            204,
            397,
            512,
            498,
            438,
            406,
            360,
            498,
            498,
            553,
            536,
            473,
            442,
            229,
            439,
            521,
            21,
            444,
            460,
            543,
            261,
            123,
            340,
            334,
            85,
            336,
            434,
            207,
            490,
            393,
            393,
            477,
            557,
            151,
            364,
            314,
            224,
            275,
            467,
            167,
            280,
            413,
            226,
            432,
            174,
            250,
            472,
            365,
            420,
            377,
            495,
            352,
            499,
            103,
            441,
            258,
            385,
            353,
            395,
            545,
            405,
            441,
            252,
            337,
            162,
            397,
            538,
            281,
            402,
            239,
            274,
            549,
            458,
            247,
            475,
            469,
            485,
            307,
            335,
            537,
            431,
            398,
            489,
            362,
            333,
            368,
            320,
            361,
            172,
            249,
            258,
            387,
            239,
            532,
            279,
            570,
            365,
            412,
            389,
            363,
            509,
            257,
            438,
            391,
            236,
            361,
            447,
            368,
            381,
            507,
            561,
            432,
            399,
            260,
            251,
            413,
            464,
            506,
            445,
            527,
            193,
            261,
            337,
            294,
            456,
            318,
            409,
            426,
            149,
            351,
            349,
            405,
            305,
            364,
            262,
            284,
            453,
            178,
            410,
            499,
            391,
            67,
            361,
            312,
            453,
            419,
            415,
            352,
            228,
            232,
            368,
            312,
            387,
            236,
            489,
            396,
            390,
            540,
            551,
            92,
            284,
            304,
            386,
            548,
            457,
            485,
            250,
            411,
            313,
            504,
            417,
            340,
            523,
            374,
            258,
            226,
            407,
            278,
            358,
            432,
            541,
            373,
            291,
            303,
            474,
            319,
            488,
            398,
            433,
            139,
            400,
            455,
            465,
            419,
            316,
            514,
            543,
            475,
            439,
            443,
            425,
            430,
            380,
            481,
            472,
            277,
            174,
            154,
            413,
            384,
            478,
            363,
            453,
            444,
            339,
            292,
            402,
            82,
            331,
            311,
            394,
            311,
            291,
            428,
            186,
            128,
            556,
            410,
            310,
            312,
            160,
            388,
            221,
            198,
            283,
            143,
            325,
            349,
            482,
            46,
            79,
            181,
            368,
            433,
            415,
            364,
            524,
            62,
            47,
            485,
            246,
            42,
            530,
            147,
            331,
            144,
            115,
            427,
            314,
            320,
            342,
            423,
            301,
            112,
            228,
            405,
            388,
            410,
            409,
            256,
            392,
            435,
            367,
            333,
            274,
            310,
            411,
            414,
            372,
            240,
            407,
            178,
            404,
            356,
            329,
            445,
            260,
            475,
            373,
            252,
            335,
            456,
            270,
            244,
            200,
            306,
            439,
            355,
            325,
            461,
            424,
            463,
            278,
            441,
            282,
            230,
            384,
            251,
            466,
            332
        ],
        "quickdraw": [
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350,
            350
        ]
    }
}

settings['log_interval'] = settings['expt_dict'][dataset][task]['val_after']
settings['start_iter'] = 0
settings['max_iter'] = settings['expt_dict'][dataset][task]['max_iter']
settings['enough_iter'] = settings['expt_dict'][dataset][task]['enough_iter']
settings['val_after'] = settings['expt_dict'][dataset][task]['val_after']
settings['batch_size'] = settings['expt_dict'][dataset][task]['batch_size']
settings['val_batch_size_factor'] = settings['expt_dict'][dataset][task]['val_batch_size_factor']
if args.expt == 'paramsen':
    settings['val_after'] = settings['val_after'] // 10
    settings['max_iter'] = settings['enough_iter'] + 20 * settings['val_after']


settings['load_model'] = args.load
load_iter = settings['enough_iter']
if args.load_iter >= 0:
    load_iter = args.load_iter
settings['model_dict'] = {
    'exp_name': settings['exp_name'], 'iter': load_iter}
settings['opt_dict'] = {
    'exp_name': settings['exp_name'], 'iter': load_iter}
